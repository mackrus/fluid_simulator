(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&e(t)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();var m=document.getElementById("myCanvas"),d=m.getContext("2d");m.width=window.innerWidth;m.height=window.innerHeight;m.focus();var R=1.01,w=m.height/R,U=m.width/w,P=0,E=1,A=2;function F(h){return h*w}function L(h){return m.height-h*w}class W{constructor(s,r,e,n){this.density=s,this.numX=r+2,this.numY=e+2,this.numCells=this.numX*this.numY,this.h=n,this.u=new Float32Array(this.numCells),this.v=new Float32Array(this.numCells),this.newU=new Float32Array(this.numCells),this.newV=new Float32Array(this.numCells),this.p=new Float32Array(this.numCells),this.s=new Float32Array(this.numCells),this.m=new Float32Array(this.numCells),this.newM=new Float32Array(this.numCells),this.m.fill(1)}solveIncompressibility(s,r){for(var e=this.numY,n=this.density*this.h/r,a=0;a<s;a++)for(var t=1;t<this.numX-1;t++)for(var i=1;i<this.numY-1;i++)if(this.s[t*e+i]!=0){var c=this.s[t*e+i],o=this.s[(t-1)*e+i],v=this.s[(t+1)*e+i],u=this.s[t*e+i-1],f=this.s[t*e+i+1],c=o+v+u+f;if(c!=0){var p=this.u[(t+1)*e+i]-this.u[t*e+i]+this.v[t*e+i+1]-this.v[t*e+i],g=-p/c;g*=l.overRelaxation,this.p[t*e+i]+=n*g,this.u[t*e+i]-=o*g,this.u[(t+1)*e+i]+=v*g,this.v[t*e+i]-=u*g,this.v[t*e+i+1]+=f*g}}}sampleField(s,r,e){var n=this.numY,a=this.h,t=1/a,i=.5*a;s=Math.max(Math.min(s,this.numX*a),a),r=Math.max(Math.min(r,this.numY*a),a);var o=0,v=0,u;switch(e){case P:u=this.u,v=i;break;case E:u=this.v,o=i;break;case A:u=this.m,o=i,v=i;break}var f=Math.min(Math.floor((s-o)*t),this.numX-1),c=(s-o-f*a)*t,p=Math.min(f+1,this.numX-1),g=Math.min(Math.floor((r-v)*t),this.numY-1),Y=(r-v-g*a)*t,b=Math.min(g+1,this.numY-1),X=1-c,M=1-Y,y=X*M*u[f*n+g]+c*M*u[p*n+g]+c*Y*u[p*n+b]+X*Y*u[f*n+b];return y}avgU(s,r){var e=this.numY,n=(this.u[s*e+r-1]+this.u[s*e+r]+this.u[(s+1)*e+r-1]+this.u[(s+1)*e+r])*.25;return n}avgV(s,r){var e=this.numY,n=(this.v[(s-1)*e+r]+this.v[s*e+r]+this.v[(s-1)*e+r+1]+this.v[s*e+r+1])*.25;return n}advectVel(s){this.newU.set(this.u),this.newV.set(this.v);for(var r=this.numY,e=this.h,n=.5*e,a=1;a<this.numX;a++)for(var t=1;t<this.numY;t++){if(this.s[a*r+t]!=0&&this.s[(a-1)*r+t]!=0&&t<this.numY-1){var i=a*e,o=t*e+n,v=this.u[a*r+t],u=this.avgV(a,t);i=i-s*v,o=o-s*u,v=this.sampleField(i,o,P),this.newU[a*r+t]=v}if(this.s[a*r+t]!=0&&this.s[a*r+t-1]!=0&&a<this.numX-1){var i=a*e+n,o=t*e,v=this.avgU(a,t),u=this.v[a*r+t];i=i-s*v,o=o-s*u,u=this.sampleField(i,o,E),this.newV[a*r+t]=u}}this.u.set(this.newU),this.v.set(this.newV)}advectSmoke(s){this.newM.set(this.m);for(var r=this.numY,e=this.h,n=.5*e,a=1;a<this.numX-1;a++)for(var t=1;t<this.numY-1;t++)if(this.s[a*r+t]!=0){var i=(this.u[a*r+t]+this.u[(a+1)*r+t])*.5,o=(this.v[a*r+t]+this.v[a*r+t+1])*.5,v=a*e+n-s*i,u=t*e+n-s*o;this.newM[a*r+t]=this.sampleField(v,u,A)}this.m.set(this.newM)}simulate(s,r){this.solveIncompressibility(r,s),this.advectVel(s),this.advectSmoke(s)}}var l={dt:1/120,numIters:100,frameNr:0,overRelaxation:1.9,obstacleX:2,obstacleY:0,obstacleRadius:.15,paused:!1,sceneNr:0,fluid:null};function x(h=0){l.sceneNr=h,l.obstacleRadius=.1,l.overRelaxation=1.85,l.dt=1/120,l.numIters=20;var s=210,r=1,e=r/R*U,n=r/s,a=Math.floor(e/n),t=Math.floor(r/n),i=1e3,o=l.fluid=new W(i,a,t,n),v=o.numY;if(h==1){for(var u=4,f=0;f<o.numX;f++)for(var c=0;c<o.numY;c++){var p=1.9;(f==0||c==0||c==o.numY-1)&&(p=.001),o.s[f*v+c]=p,f==1&&(o.u[f*v+c]=u)}for(var g=.1*o.numY,Y=Math.floor(.5*o.numY-.5*g),b=Math.floor(.5*o.numY+.5*g),c=Y;c<b;c++)o.m[c]=0;D(.4,.5,!0)}}function k(){d.clearRect(0,0,m.width,m.height),d.fillStyle="#000000";for(var h=l.fluid,s=h.numY,r=1,e=h.h,n=h.p[0],a=h.p[0],t=0;t<h.numCells;t++)n=Math.min(n,h.p[t]),a=Math.max(a,h.p[t]);for(var i=d.getImageData(0,0,m.width,m.height),o=[0,0,0,0],t=0;t<h.numX;t++)for(var v=0;v<h.numY;v++){var u=1-h.m[t*s+v];o[0]=590*u,o[1]=250*u,o[2]=2500*u;for(var f=Math.floor(F(t*e)),c=Math.floor(L((v+1)*e)),p=Math.floor(w*r*e)+1,g=Math.floor(w*r*e)+1,Y=o[0],b=o[1],X=o[2],M=c;M<c+g;M++)for(var y=4*(M*m.width+f),C=0;C<p;C++)i.data[y++]=Y,i.data[y++]=b,i.data[y++]=X,i.data[y++]=100}d.putImageData(i,0,0),l.showObstacle&&(d.strokeW,Y=l.obstacleRadius+h.h,d.fillStyle="#000000",d.beginPath(),d.arc(F(l.obstacleX),L(l.obstacleY),w*Y,0,2*Math.PI),d.closePath(),d.fill(),d.lineWidth=.4,d.strokeStyle="#DDDDDD",d.beginPath(),d.arc(F(l.obstacleX),L(l.obstacleY),w*Y,0,2*Math.PI),d.closePath(),d.stroke(),d.lineWidth=.05)}function D(h,s,r){var e=0,n=0;r||(e=(h-l.obstacleX)/l.dt,n=(s-l.obstacleY)/l.dt),l.obstacleX=h,l.obstacleY=s;var a=l.obstacleRadius,t=l.fluid,i=t.numY;Math.sqrt(2)*t.h;for(var o=1;o<t.numX-2;o++)for(var v=1;v<t.numY-2;v++){t.s[o*i+v]=1;var u=(o+.5)*t.h-h,f=(v+.5)*t.h-s;u*u+f*f<a*a&&(t.s[o*i+v]=0,l.sceneNr==2?t.m[o*i+v]=.5+.5*Math.sin(.1*l.frameNr):t.m[o*i+v]=1,t.u[o*i+v]=e,t.u[(o+1)*i+v]=e,t.v[o*i+v]=n,t.v[o*i+v+1]=n)}l.showObstacle=!0}var I=!1;function S(h,s){let r=m.getBoundingClientRect(),e=h-r.left-m.clientLeft,n=s-r.top-m.clientTop;I=!0,h=e/w,s=(m.height-n)/w,D(h,s,!0)}function O(h,s){if(I){let r=m.getBoundingClientRect(),e=h-r.left-m.clientLeft,n=s-r.top-m.clientTop;h=e/w,s=(m.height-n)/w,D(h,s,!1)}}function V(){I=!1}m.addEventListener("mousedown",h=>{S(h.x,h.y)});m.addEventListener("mouseup",h=>{V()});m.addEventListener("mousemove",h=>{O(h.x,h.y)});m.addEventListener("touchstart",h=>{S(h.touches[0].clientX,h.touches[0].clientY)});m.addEventListener("touchend",h=>{V()});m.addEventListener("touchmove",h=>{h.preventDefault(),h.stopImmediatePropagation(),O(h.touches[0].clientX,h.touches[0].clientY)},{passive:!1});function q(){l.fluid.simulate(l.dt,l.numIters),l.frameNr++}function N(){q(),k(),requestAnimationFrame(N)}x(1);N();
//# sourceMappingURL=index-Ne2NvgXP.js.map
